{"remainingRequest":"D:\\work\\工作\\文旅\\基础架构\\pig-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\工作\\文旅\\基础架构\\pig-ui\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\work\\工作\\文旅\\基础架构\\pig-ui\\src\\permission.js","dependencies":[{"path":"D:\\work\\工作\\文旅\\基础架构\\pig-ui\\src\\permission.js","mtime":1551667984183},{"path":"D:\\work\\工作\\文旅\\基础架构\\pig-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\工作\\文旅\\基础架构\\pig-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\work\\工作\\文旅\\基础架构\\pig-ui\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"D:\\\\work\\\\\\u5DE5\\u4F5C\\\\\\u6587\\u65C5\\\\\\u57FA\\u7840\\u67B6\\u6784\\\\pig-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n\n/**\r\n * 全站权限配置\r\n *\r\n */\nimport router from './router/router';\nimport store from '@/store';\nimport { getStore } from '@/util/store';\nimport { validatenull } from '@/util/validate';\nimport NProgress from 'nprogress'; // progress bar\n\nimport 'nprogress/nprogress.css'; // progress bar style\n\nNProgress.configure({\n  showSpinner: false\n});\nvar lockPage = store.getters.website.lockPage; // 锁屏页\n\nrouter.beforeEach(function (to, from, next) {\n  // 缓冲设置\n  if (to.meta.keepAlive === true && store.state.tags.tagList.some(function (ele) {\n    return ele.value === to.fullPath;\n  })) {\n    to.meta.$keepAlive = true;\n  } else {\n    NProgress.start();\n\n    if (to.meta.keepAlive === true && validatenull(to.meta.$keepAlive)) {\n      to.meta.$keepAlive = true;\n    } else {\n      to.meta.$keepAlive = false;\n    }\n  }\n\n  var meta = to.meta || {};\n\n  if (store.getters.access_token) {\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n    } else {\n      if (store.getters.roles.length === 0) {\n        store.dispatch('GetUserInfo').then(function () {\n          next(_objectSpread({}, to, {\n            replace: true\n          }));\n        }).catch(function () {\n          store.dispatch('FedLogOut').then(function () {\n            next({\n              path: '/login'\n            });\n          });\n        });\n      } else {\n        var value = to.query.src || to.fullPath;\n        var label = to.query.name || to.name;\n\n        if (meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            group: router.$avueRouter.group || []\n          });\n        }\n\n        next();\n      }\n    }\n  } else {\n    if (meta.isAuth === false) {\n      next();\n    } else {\n      next('/login');\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n  var title = store.getters.tag.label;\n  router.$avueRouter.setTitle(title);\n});",{"version":3,"sources":["D:\\work\\工作\\文旅\\基础架构\\pig-ui\\src\\permission.js"],"names":["router","store","getStore","validatenull","NProgress","configure","showSpinner","lockPage","getters","website","beforeEach","to","from","next","meta","keepAlive","state","tags","tagList","some","ele","value","fullPath","$keepAlive","start","access_token","path","roles","length","dispatch","then","replace","catch","query","src","label","name","isTab","commit","params","group","$avueRouter","isAuth","afterEach","done","title","tag","setTitle"],"mappings":"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","sourcesContent":["/**\r\n * 全站权限配置\r\n *\r\n */\r\nimport router from './router/router'\r\nimport store from '@/store'\r\nimport {getStore} from '@/util/store'\r\nimport {validatenull} from '@/util/validate'\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nNProgress.configure({showSpinner: false})\r\nconst lockPage = store.getters.website.lockPage // 锁屏页\r\nrouter.beforeEach((to, from, next) => {\r\n  // 缓冲设置\r\n  if (to.meta.keepAlive === true && store.state.tags.tagList.some(ele => {\r\n    return ele.value === to.fullPath\r\n  })) {\r\n    to.meta.$keepAlive = true\r\n  } else {\r\n    NProgress.start()\r\n    if (to.meta.keepAlive === true && validatenull(to.meta.$keepAlive)) {\r\n      to.meta.$keepAlive = true\r\n    } else {\r\n      to.meta.$keepAlive = false\r\n    }\r\n  }\r\n  const meta = to.meta || {}\r\n  if (store.getters.access_token) {\r\n   if (to.path === '/login') {\r\n      next({path: '/'})\r\n    } else {\r\n      if (store.getters.roles.length === 0) {\r\n        store.dispatch('GetUserInfo').then(() => {\r\n          next({...to, replace: true})\r\n        }).catch(() => {\r\n          store.dispatch('FedLogOut').then(() => {\r\n            next({path: '/login'})\r\n          })\r\n        })\r\n      } else {\r\n        const value = to.query.src || to.fullPath\r\n        const label = to.query.name || to.name\r\n        if (meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\r\n          store.commit('ADD_TAG', {\r\n            label: label,\r\n            value: value,\r\n            params: to.params,\r\n            query: to.query,\r\n            group: router.$avueRouter.group || []\r\n          })\r\n        }\r\n        next()\r\n      }\r\n    }\r\n  } else {\r\n    if (meta.isAuth === false) {\r\n      next()\r\n    } else {\r\n      next('/login')\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done()\r\n  const title = store.getters.tag.label\r\n  router.$avueRouter.setTitle(title)\r\n})\r\n"]}]}