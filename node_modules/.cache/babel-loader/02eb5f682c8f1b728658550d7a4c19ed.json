{"remainingRequest":"D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\node_modules\\babel-loader\\lib\\index.js!D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\src\\store\\modules\\user.js","mtime":1556523947184},{"path":"D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"D:\\\\work\\\\\\u5DE5\\u4F5C\\\\\\u4E2A\\u4EBA\\\\\\u4E2A\\u4EBA\\u9879\\u76EE\\\\rzl-cloud\\\\smaker-admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { getStore, setStore } from '@/util/store';\nimport { isURL } from '@/util/validate';\nimport { getUserInfo, loginByMobile, loginBySocial, loginByUsername, logout, refreshToken } from '@/api/login';\nimport { deepClone, encryption } from '@/util/util';\nimport webiste from '@/const/website';\nimport { GetMenu as _GetMenu } from '@/api/admin/menu';\n\nfunction addPath(ele, first) {\n  var propsConfig = webiste.menu.props;\n  var propsDefault = {\n    label: propsConfig.label || 'label',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  var isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n\n  if (!isChild && first) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index';\n    return;\n  }\n\n  ele[propsDefault.children].forEach(function (child) {\n    if (!isURL(child[propsDefault.path])) {\n      child[propsDefault.path] = \"\".concat(ele[propsDefault.path], \"/\").concat(child[propsDefault.path] ? child[propsDefault.path] : 'index');\n    }\n\n    addPath(child);\n  });\n}\n\nvar user = {\n  state: {\n    userInfo: {},\n    permissions: {},\n    roles: [],\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    expires_in: getStore({\n      name: 'expires_in'\n    }) || '',\n    access_token: getStore({\n      name: 'access_token'\n    }) || '',\n    refresh_token: getStore({\n      name: 'refresh_token'\n    }) || ''\n  },\n  actions: {\n    // 根据用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      var user = encryption({\n        data: userInfo,\n        key: 'smakercloudrenzl',\n        param: ['password']\n      });\n      return new _Promise(function (resolve, reject) {\n        loginByUsername(user.username, user.password, user.code, user.randomStr).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 根据手机号登录\n    LoginByPhone: function LoginByPhone(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new _Promise(function (resolve, reject) {\n        loginByMobile(userInfo.mobile, userInfo.code).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 根据OpenId登录\n    LoginBySocial: function LoginBySocial(_ref3, param) {\n      var commit = _ref3.commit;\n      return new _Promise(function (resolve, reject) {\n        loginBySocial(param.state, param.code).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    GetUserInfo: function GetUserInfo(_ref4) {\n      var commit = _ref4.commit;\n      return new _Promise(function (resolve, reject) {\n        getUserInfo().then(function (res) {\n          var data = res.data.data || {};\n          commit('SET_USERIFNO', data.sysUser);\n          commit('SET_ROLES', data.roles || []);\n          commit('SET_PERMISSIONS', data.permissions || []);\n          resolve(data);\n        }).catch(function (err) {\n          reject();\n        });\n      });\n    },\n    // 刷新token\n    RefreshToken: function RefreshToken(_ref5) {\n      var commit = _ref5.commit,\n          state = _ref5.state;\n      return new _Promise(function (resolve, reject) {\n        refreshToken(state.refresh_token).then(function (response) {\n          var data = response.data;\n          commit('SET_ACCESS_TOKEN', data.access_token);\n          commit('SET_REFRESH_TOKEN', data.refresh_token);\n          commit('SET_EXPIRES_IN', data.expires_in);\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref6) {\n      var commit = _ref6.commit;\n      return new _Promise(function (resolve, reject) {\n        logout().then(function () {\n          commit('SET_MENU', []);\n          commit('SET_PERMISSIONS', []);\n          commit('SET_USER_INFO', {});\n          commit('SET_ACCESS_TOKEN', '');\n          commit('SET_REFRESH_TOKEN', '');\n          commit('SET_EXPIRES_IN', '');\n          commit('SET_ROLES', []);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 注销session\n    FedLogOut: function FedLogOut(_ref7) {\n      var commit = _ref7.commit;\n      return new _Promise(function (resolve) {\n        commit('SET_MENU', []);\n        commit('SET_PERMISSIONS', []);\n        commit('SET_USER_INFO', {});\n        commit('SET_ACCESS_TOKEN', '');\n        commit('SET_REFRESH_TOKEN', '');\n        commit('SET_ROLES', []);\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        resolve();\n      });\n    },\n    // 获取系统菜单\n    GetMenu: function GetMenu(_ref8) {\n      var commit = _ref8.commit;\n      return new _Promise(function (resolve) {\n        _GetMenu().then(function (res) {\n          var data = res.data.data;\n          var menu = deepClone(data);\n          menu.forEach(function (ele) {\n            addPath(ele);\n          });\n          commit('SET_MENU', menu);\n          resolve(menu);\n        });\n      });\n    }\n  },\n  mutations: {\n    SET_ACCESS_TOKEN: function SET_ACCESS_TOKEN(state, access_token) {\n      state.access_token = access_token;\n      setStore({\n        name: 'access_token',\n        content: state.access_token,\n        type: 'session'\n      });\n    },\n    SET_EXPIRES_IN: function SET_EXPIRES_IN(state, expires_in) {\n      state.expires_in = expires_in;\n      setStore({\n        name: 'expires_in',\n        content: state.expires_in,\n        type: 'session'\n      });\n    },\n    SET_REFRESH_TOKEN: function SET_REFRESH_TOKEN(state, rfToken) {\n      state.refresh_token = rfToken;\n      setStore({\n        name: 'refresh_token',\n        content: state.refresh_token,\n        type: 'session'\n      });\n    },\n    SET_USERIFNO: function SET_USERIFNO(state, userInfo) {\n      state.userInfo = userInfo;\n    },\n    SET_MENU: function SET_MENU(state, menu) {\n      state.menu = menu;\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      });\n    },\n    SET_MENU_ALL: function SET_MENU_ALL(state, menuAll) {\n      state.menuAll = menuAll;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n      var list = {};\n\n      for (var i = 0; i < permissions.length; i++) {\n        list[permissions[i]] = true;\n      }\n\n      state.permissions = list;\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["D:\\work\\工作\\个人\\个人项目\\rzl-cloud\\smaker-admin\\src\\store\\modules\\user.js"],"names":["getStore","setStore","isURL","getUserInfo","loginByMobile","loginBySocial","loginByUsername","logout","refreshToken","deepClone","encryption","webiste","GetMenu","addPath","ele","first","propsConfig","menu","props","propsDefault","label","path","icon","children","isChild","length","forEach","child","user","state","userInfo","permissions","roles","name","menuAll","expires_in","access_token","refresh_token","actions","LoginByUsername","commit","data","key","param","resolve","reject","username","password","code","randomStr","then","response","catch","error","LoginByPhone","mobile","LoginBySocial","GetUserInfo","res","sysUser","err","RefreshToken","LogOut","FedLogOut","mutations","SET_ACCESS_TOKEN","content","type","SET_EXPIRES_IN","SET_REFRESH_TOKEN","rfToken","SET_USERIFNO","SET_MENU","SET_MENU_ALL","SET_ROLES","SET_PERMISSIONS","list","i"],"mappings":"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","sourcesContent":["import {getStore, setStore} from '@/util/store'\r\nimport {isURL} from '@/util/validate'\r\nimport {getUserInfo, loginByMobile, loginBySocial, loginByUsername, logout, refreshToken} from '@/api/login'\r\nimport {deepClone, encryption} from '@/util/util'\r\nimport webiste from '@/const/website'\r\nimport {GetMenu} from '@/api/admin/menu'\r\n\r\nfunction addPath(ele, first) {\r\n  const propsConfig = webiste.menu.props\r\n  const propsDefault = {\r\n    label: propsConfig.label || 'label',\r\n    path: propsConfig.path || 'path',\r\n    icon: propsConfig.icon || 'icon',\r\n    children: propsConfig.children || 'children'\r\n  }\r\n  const isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0\r\n  if (!isChild && first) {\r\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index'\r\n    return\r\n  }\r\n  ele[propsDefault.children].forEach(child => {\r\n    if (!isURL(child[propsDefault.path])) {\r\n      child[propsDefault.path] = `${ele[propsDefault.path]}/${child[propsDefault.path] ? child[propsDefault.path] : 'index'}`\r\n    }\r\n    addPath(child)\r\n  })\r\n}\r\n\r\nconst user = {\r\n  state: {\r\n    userInfo: {},\r\n    permissions: {},\r\n    roles: [],\r\n    menu: getStore({\r\n      name: 'menu'\r\n    }) || [],\r\n    menuAll: [],\r\n    expires_in: getStore({\r\n      name: 'expires_in'\r\n    }) || '',\r\n    access_token: getStore({\r\n      name: 'access_token'\r\n    }) || '',\r\n    refresh_token: getStore({\r\n      name: 'refresh_token'\r\n    }) || ''\r\n  },\r\n  actions: {\r\n    // 根据用户名登录\r\n    LoginByUsername({commit}, userInfo) {\r\n      const user = encryption({\r\n        data: userInfo,\r\n        key: 'smakercloudrenzl',\r\n        param: ['password']\r\n      })\r\n      return new Promise((resolve, reject) => {\r\n        loginByUsername(user.username, user.password, user.code, user.randomStr).then(response => {\r\n          const data = response.data\r\n          commit('SET_ACCESS_TOKEN', data.access_token)\r\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\r\n          commit('SET_EXPIRES_IN', data.expires_in)\r\n          commit('CLEAR_LOCK')\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 根据手机号登录\r\n    LoginByPhone({commit}, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        loginByMobile(userInfo.mobile, userInfo.code).then(response => {\r\n          const data = response.data\r\n          commit('SET_ACCESS_TOKEN', data.access_token)\r\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\r\n          commit('SET_EXPIRES_IN', data.expires_in)\r\n          commit('CLEAR_LOCK')\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 根据OpenId登录\r\n    LoginBySocial({commit}, param) {\r\n      return new Promise((resolve, reject) => {\r\n        loginBySocial(param.state, param.code).then(response => {\r\n          const data = response.data\r\n          commit('SET_ACCESS_TOKEN', data.access_token)\r\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\r\n          commit('SET_EXPIRES_IN', data.expires_in)\r\n          commit('CLEAR_LOCK')\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    GetUserInfo({commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        getUserInfo().then((res) => {\r\n          const data = res.data.data || {}\r\n          commit('SET_USERIFNO', data.sysUser)\r\n          commit('SET_ROLES', data.roles || [])\r\n          commit('SET_PERMISSIONS', data.permissions || [])\r\n          resolve(data)\r\n        }).catch((err) => {\r\n          reject()\r\n        })\r\n      })\r\n    },\r\n    // 刷新token\r\n    RefreshToken({commit, state}) {\r\n      return new Promise((resolve, reject) => {\r\n        refreshToken(state.refresh_token).then(response => {\r\n          const data = response.data\r\n          commit('SET_ACCESS_TOKEN', data.access_token)\r\n          commit('SET_REFRESH_TOKEN', data.refresh_token)\r\n          commit('SET_EXPIRES_IN', data.expires_in)\r\n          commit('CLEAR_LOCK')\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 登出\r\n    LogOut({commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        logout().then(() => {\r\n          commit('SET_MENU', [])\r\n          commit('SET_PERMISSIONS', [])\r\n          commit('SET_USER_INFO', {})\r\n          commit('SET_ACCESS_TOKEN', '')\r\n          commit('SET_REFRESH_TOKEN', '')\r\n          commit('SET_EXPIRES_IN', '')\r\n          commit('SET_ROLES', [])\r\n          commit('DEL_ALL_TAG')\r\n          commit('CLEAR_LOCK')\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 注销session\r\n    FedLogOut({commit}) {\r\n      return new Promise(resolve => {\r\n        commit('SET_MENU', [])\r\n        commit('SET_PERMISSIONS', [])\r\n        commit('SET_USER_INFO', {})\r\n        commit('SET_ACCESS_TOKEN', '')\r\n        commit('SET_REFRESH_TOKEN', '')\r\n        commit('SET_ROLES', [])\r\n        commit('DEL_ALL_TAG')\r\n        commit('CLEAR_LOCK')\r\n        resolve()\r\n      })\r\n    },\r\n    // 获取系统菜单\r\n    GetMenu({\r\n              commit\r\n            }) {\r\n      return new Promise(resolve => {\r\n        GetMenu().then((res) => {\r\n          const data = res.data.data\r\n          let menu = deepClone(data)\r\n          menu.forEach(ele => {\r\n            addPath(ele)\r\n          })\r\n          commit('SET_MENU', menu)\r\n          resolve(menu)\r\n        })\r\n      })\r\n    }\r\n\r\n  },\r\n  mutations: {\r\n    SET_ACCESS_TOKEN: (state, access_token) => {\r\n      state.access_token = access_token\r\n      setStore({\r\n        name: 'access_token',\r\n        content: state.access_token,\r\n        type: 'session'\r\n      })\r\n    },\r\n    SET_EXPIRES_IN: (state, expires_in) => {\r\n      state.expires_in = expires_in\r\n      setStore({\r\n        name: 'expires_in',\r\n        content: state.expires_in,\r\n        type: 'session'\r\n      })\r\n    },\r\n    SET_REFRESH_TOKEN: (state, rfToken) => {\r\n      state.refresh_token = rfToken\r\n      setStore({\r\n        name: 'refresh_token',\r\n        content: state.refresh_token,\r\n        type: 'session'\r\n      })\r\n    },\r\n    SET_USERIFNO: (state, userInfo) => {\r\n      state.userInfo = userInfo\r\n    },\r\n    SET_MENU: (state, menu) => {\r\n      state.menu = menu\r\n      setStore({\r\n        name: 'menu',\r\n        content: state.menu,\r\n        type: 'session'\r\n      })\r\n    },\r\n    SET_MENU_ALL: (state, menuAll) => {\r\n      state.menuAll = menuAll\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles\r\n    },\r\n    SET_PERMISSIONS: (state, permissions) => {\r\n      const list = {}\r\n      for (let i = 0; i < permissions.length; i++) {\r\n        list[permissions[i]] = true\r\n      }\r\n      state.permissions = list\r\n    }\r\n  }\r\n\r\n}\r\nexport default user\r\n"]}]}